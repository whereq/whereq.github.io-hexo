---
title: Merkle Tree in Chinese
date: 2025-04-21 18:54:45
categories:
- Cypto Currency
- Ethereum
- Data Structure
tags:
- Cypto Currency
- Ethereum
- Data Structure
---

Merkle Treeï¼ˆé»˜å…‹å°”æ ‘ï¼‰åœ¨åŒºå—é“¾ã€å¯†ç å­¦å’Œæ•°æ®å®Œæ•´æ€§éªŒè¯ä¸­æ˜¯ä¸€ä¸ªéžå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚å®ƒæ˜¯ä¸€ç§**æ ‘çŠ¶æ•°æ®ç»“æž„**ï¼Œç”¨æ¥é«˜æ•ˆè€Œå®‰å…¨åœ°éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ã€‚

---

## ðŸŒ³ ä¸€ã€Merkle Tree æ˜¯ä»€ä¹ˆï¼Ÿ

Merkle Tree æ˜¯ä¸€ç§**äºŒå‰æ ‘ç»“æž„**ï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹æ˜¯æŸä¸€ç¬”æ•°æ®çš„å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªéžå¶å­èŠ‚ç‚¹æ˜¯å…¶å­èŠ‚ç‚¹å“ˆå¸Œå€¼çš„ç»„åˆå†å“ˆå¸ŒåŽçš„ç»“æžœï¼Œç›´åˆ°æ ¹èŠ‚ç‚¹ â€”â€” Merkle Rootã€‚

### ðŸ“Œ ç‰¹ç‚¹ï¼š

- å¿«é€ŸéªŒè¯æŸæ¡æ•°æ®æ˜¯å¦å±žäºŽæŸæ‰¹æ•°æ®ï¼ˆO(log n)ï¼‰
- æ•°æ®å®Œæ•´æ€§æ ¡éªŒéžå¸¸é«˜æ•ˆ
- å¹¿æ³›ç”¨äºŽåŒºå—é“¾ä¸­ï¼ˆæ¯”ç‰¹å¸ã€ä»¥å¤ªåŠï¼‰ä»¥éªŒè¯äº¤æ˜“

---

## ðŸ§© äºŒã€å›¾ç¤ºè¯´æ˜Ž

å‡è®¾æˆ‘ä»¬æœ‰ 4 ä¸ªäº¤æ˜“ `Tx0, Tx1, Tx2, Tx3`ï¼š

```
               Merkle Root
                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                â”‚
        Hash01           Hash23
       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    Hash0      Hash1  Hash2     Hash3
    â”‚            â”‚     â”‚          â”‚
  Tx0          Tx1   Tx2        Tx3
```

### å“ˆå¸Œè¿‡ç¨‹ï¼š

- `Hash0 = hash(Tx0)`ï¼Œ`Hash1 = hash(Tx1)`
- `Hash01 = hash(Hash0 + Hash1)`
- `Merkle Root = hash(Hash01 + Hash23)`

---

## ðŸ’¡ ä¸‰ã€Merkle Tree çš„ä½œç”¨

### âœ… åœ¨åŒºå—é“¾ä¸­ä¸»è¦ç”¨æ¥ï¼š

| ç”¨é€”                      | è¯´æ˜Ž |
|---------------------------|------|
| éªŒè¯äº¤æ˜“æ˜¯å¦åœ¨åŒºå—ä¸­       | æ¯”å¦‚æ¯”ç‰¹å¸ SPVï¼ˆè½»èŠ‚ç‚¹ï¼‰ç”¨æ¥éªŒè¯ä¸€ç¬”äº¤æ˜“æ˜¯å¦åœ¨åŒºå—ä¸­ï¼Œæ— éœ€ä¸‹è½½æ•´ä¸ªåŒºå— |
| ä¿è¯æ•°æ®ä¸å¯ç¯¡æ”¹           | å³ä½¿æ›´æ”¹ä¸€ç¬”äº¤æ˜“ï¼ŒMerkle Root ä¹Ÿä¼šå®Œå…¨ä¸åŒ |
| æ‰¹é‡å¤„ç†å¤§é‡æ•°æ®çš„å®Œæ•´æ€§éªŒè¯ | ç”¨äºŽ IPFSã€æ–‡ä»¶æ ¡éªŒã€åŒºå—å¿«ç…§ |

---

## ðŸ§ª å››ã€ä¸€ä¸ªç®€å•çš„ Merkle Tree å®žçŽ°ï¼ˆç”¨ JavaScriptï¼‰

```ts
import { createHash } from 'crypto';

function sha256(data: string) {
  return createHash('sha256').update(data).digest('hex');
}

// æž„å»º Merkle Tree å¹¶è¿”å›žæ ¹èŠ‚ç‚¹
function buildMerkleTree(leaves: string[]): string {
  if (leaves.length === 0) return '';

  let level = leaves.map(sha256);

  while (level.length > 1) {
    const nextLevel: string[] = [];

    for (let i = 0; i < level.length; i += 2) {
      const left = level[i];
      const right = level[i + 1] ?? left; // å¦‚æžœæ˜¯å¥‡æ•°ï¼Œå¤åˆ¶æœ€åŽä¸€ä¸ª
      nextLevel.push(sha256(left + right));
    }

    level = nextLevel;
  }

  return level[0];
}

// ç¤ºä¾‹
const txs = ['tx0', 'tx1', 'tx2', 'tx3'];
console.log('Merkle Root:', buildMerkleTree(txs));
```

---

## ðŸ” äº”ã€å¦‚ä½•éªŒè¯æŸç¬”äº¤æ˜“åœ¨ Merkle Tree ä¸­ï¼Ÿ

éªŒè¯æ­¥éª¤æ˜¯ï¼š

1. èŽ·å–ä½ é‚£ç¬”äº¤æ˜“çš„å“ˆå¸Œï¼ˆæ¯”å¦‚ `tx1 â†’ h1`ï¼‰
2. èŽ·å–ä½ éœ€è¦éªŒè¯è·¯å¾„çš„å…„å¼ŸèŠ‚ç‚¹å“ˆå¸Œï¼ˆç§°ä¸ºâ€œMerkle Proofâ€ï¼‰
3. é€å±‚æ‹¼æŽ¥å¹¶è®¡ç®—ï¼Œç›´åˆ°å¾—å‡º Merkle Root
4. çœ‹æ˜¯å¦å’ŒçœŸæ­£çš„ Merkle Root åŒ¹é…

è¿™æ ·ä½ å°±å¯ä»¥**ä»…å‡­éƒ¨åˆ†æ•°æ®éªŒè¯æ•´æ‰¹æ•°æ®å®Œæ•´æ€§**ï¼Œè¿™åœ¨åŒºå—é“¾è½»èŠ‚ç‚¹ä¸­å°¤ä¸ºé‡è¦ã€‚

---

## ðŸ“¦ å…­ã€çœŸå®žåŒºå—é“¾åœºæ™¯

### ä»¥å¤ªåŠä¸­ï¼š

- å¹¶ä¸ç›´æŽ¥ä½¿ç”¨äºŒå‰ Merkle Treeï¼Œè€Œæ˜¯ä½¿ç”¨æ”¹è¿›ç‰ˆï¼š**Merkle Patricia Trie** æ¥å¤„ç†çŠ¶æ€ï¼ˆè´¦æˆ·ã€ä½™é¢ç­‰ï¼‰
- åŒºå—å¤´ä¸­çš„ `transactionsRoot`ã€`stateRoot` ç­‰å­—æ®µå°±æ˜¯ Merkle æ ¹

### æ¯”ç‰¹å¸ä¸­ï¼š

- åŒºå—ä¸­çš„ `merkle_root` å­—æ®µæ˜¯æ‰€æœ‰äº¤æ˜“çš„ Merkle æ ¹
- æ”¯æŒè½»èŠ‚ç‚¹ï¼ˆSPVï¼‰é€šè¿‡ Merkle Proof éªŒè¯äº¤æ˜“

---

## ðŸ§¾ ä¸ƒã€æ€»ç»“é‡ç‚¹

| é¡¹ç›®       | å†…å®¹                                                         |
|------------|--------------------------------------------------------------|
| æ˜¯ä»€ä¹ˆ     | äºŒå‰å“ˆå¸Œæ ‘ï¼Œç”¨äºŽéªŒè¯å¤§æ‰¹æ•°æ®ä¸­æŸä¸€æ¡æ•°æ®æ˜¯å¦å­˜åœ¨              |
| ä¸ºä»€ä¹ˆé‡è¦ | é«˜æ•ˆéªŒè¯ã€é˜²ç¯¡æ”¹ã€è½»èŠ‚ç‚¹æ”¯æŒ                                 |
| åŒºå—é“¾ç”¨é€” | äº¤æ˜“éªŒè¯ã€çŠ¶æ€éªŒè¯ã€æ•°æ®å®Œæ•´æ€§è¯æ˜Ž                           |
| ä¼˜ç‚¹       | ç©ºé—´å ç”¨å°ï¼ŒéªŒè¯æ—¶é—´å¿«ï¼ˆå¯¹æ•°çº§åˆ«ï¼‰ï¼Œå¯ç»„åˆè¯æ˜Ž               |
